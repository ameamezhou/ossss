# 内存的基本知识

内存是用来存放数据的，程序执行前需要加载到内存中才能被CPU进行处理 -- 缓和CPU与硬盘之间的速度矛盾

内存中也有很多个存储单元，同样的会对应内存地址，内存地址从0开始，每个地址对应一个存储单元

### 三种装入策略
1. 绝对装入
在编译的时候，如果知道程序存放在内存的哪个位置，编译程序将产生绝对地址的目标代码。装入程序按照装入模块中的地址，将程序和数据装入内存。

只适用于单道程序环境

2. 可重定位装入(静态重定位)
编译、连接后的装入模块的地址都是从0开始的，指令中使用的地址、数据存放的地址都是相对于起始地址而言的逻辑地址。可以根据内存当前的情况，将模块装入道内存的适当位置。装入时对地址进行“重定位”，将逻辑地址转为物理地址

静态重定位特点是在一个作业装入内存时，必须分配其要求的全部内存空间，如果没有足够的内存，就不能装入该作业

3. 动态运行时装入(动态重定位)
编译、连接后的装入模块地址都是从0开始的。装入程序把装入模块装入内存后，并不会立即把逻辑地址转换为物理地址，而是把地址转换推迟到程序真正要执行时才会进行。因此装入内存后所有的地址依然是逻辑地址。这种方式需要一个重定位寄存器的支持

采用动态重定位允许程序再内存中发生移动


链接的三种方式
1. 静态链接：再程序运行前，先将各目标模块以及他们所需的库函数连接成一个完整的可执行文件，之后不再拆开
2. 动态链接：将目标模块装入内存，边装入边链接的链接方式
3. 运行时动态链接：在程序执行中需要该目标模块才对它进行连接。优点是便于修改和更新，便于实现对目标模块的共享

## 内存管理的概念
1. 内存空间的分配与回收

2. 内存空间的扩充

3. 地址转换 - 负责程序的逻辑地址与物理地址的转换

4. 存储保护
保证各个进程在自己空间内运行，不越界

内存保护可采取的两种方法
- 方法一：在CPU中设置一堆上、下限寄存器，存放进程的上、下限地址，进程的指令要访问某个地址时，CPU检查是否越界
- 方法二：采用重定位寄存器(基地址寄存器)和界地址寄存器(限长寄存器)进行越界检查，重定位寄存器中存放的是进程的起始物理地址。界地址寄存器存放的是进程的最大逻辑地址

## 进程的内存映像
![内存映像](./img/1.进程的内存映像.png)
![可能考法](./img/2.可能考法.png)

## 内存空间的扩充

1. 覆盖技术
覆盖技术用来解决：当程序大小超过物理内存总和的问题

覆盖技术的思想： 将程序氛围多个段落 或者说多个模块。常用的段常驻内存，不常用的段在需要的时候调入内存

内存中分为一个 “固定区” 和 若干个 “覆盖区”。

需要常驻内存的放在固定区，调入后就不再调出，除非运行结束。

不常用的段放在覆盖区，需要用到的时候调入内存，用不到时调出内存

2. 交换技术
交换技术的思想：内存空间紧张的时候，系统将内存中某些进程暂时换出外存，把外存中某些已经具备运行条件的进程换入内存(进程在内存与磁盘间动态调度)

- 具有交换功能的操作系统中，通常把磁盘空间分为文件区和对换区两部分。文件区主要用于存放文件，主要追求存储空间的利用率，因此对文件空间的管理采用离散分配方式；兑换去空间只占磁盘空间的小部分，被换出的进程数据就存放在对换区。由于对换的速度直接影响到系统的整体速度，因此对换区空间的管理主要追求换入换出速度，因此通常对换区采用连续分配方式。总之就是对换区I/O速度比文件区更快。
- 交换通常在许多进程运行且内存吃紧的时候进行，而系统负载降低就会暂停。
- 可优先换出阻塞进程；可换出优先级比较低的进程；为了防止优先级低的进程在被调入内存后又被换出，有些系统会考虑进程在内存的驻留时间

PCB会常驻内存，不会被换出外存

3. 虚拟技术
虚拟技术单启一块

## 内存空间的分配与回收
#### 连续分配管理
1. 单一连续分配
在单一连续分配方式中，内存分为系统区和用户区。

系统区通常位于内存的低位地址部分，用于存放操作系统相关数据；用户去用于存放用户进程相关数据。
内存中只能有一道用户程序，而用户程序独占整个用户区空间

优点: 实现简单，无外部碎片。可采用覆盖技术扩充内存；不一定需要采取内存保护
2. 固定分区分配

3. 动态分区分配


#### 非连续分配管理