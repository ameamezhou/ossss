![存储空间](./img/3.存储空间.png)

存储空间划分: 将物理磁盘划分为一个个文件卷。 逻辑卷、逻辑盘

存储空间的初始化：将各个文件卷划分为目录区、文件区

# 空闲表法

空闲表：
| 第一个空闲盘块号 | 空闲盘块数 |
|:---:|:---:|
| 0 | 2 |
| 5 | 1 |
| 10 | 5 |
| 18 | 3 |
| 23 | 1 |

适用于连续分配方式

如何分配磁盘块:与内存管理中的动态分区分配很类似，为一个文件分配连续的存储空间。同样可采用首次适应、最佳适应、最坏适应等算法来决定要为文件分配哪个区间。


如何回收磁盘块:与内存管理中的动态分区分配很类似，当回收某个存储区时需要有四种情况--
1. 回收区的前后都没有相邻空闲区;
2. 回收区的前后都是空闲区:
3. 回收区前面是空闲区;
4. 回收区后面是空闲区。

总之，回收时需要注意表项的合并问题

# 空闲链表法
1. 空闲盘块链 - 以盘块为单位组成一条空闲链
操作系统保存着链头、链尾指针.

如何分配:若某文件申请K个盘块，则从链头开始依次摘下K个盘块分配，并修改空闲链的链头指针

如何回收:回收的盘块依次挂到链尾，并修改空闲链的链尾指针。

适用于离散分配的物理结构，为文件分配多个盘块的时候可能要多次重复操作



2. 空闲盘区链 - 以盘区为单位组成一条空闲链
操作系统保存着链头、链尾指针.

如何分配:若某文件申请K 个盘块，则可以采用首次适应、最佳适应等算法，从链头开始检索，按照算法规则找到一个大小符合要求的空闲盘区分配给文件。若没有合适的连续空闲块，也可以将不同盘区的盘块同时分配给一个文件，注意分配后可能要修改相应的链指针、盘区大小等数据。

如何回收:若回收区和某个空闲盘区相邻，则需要将回收区合并到空闲盘区中。若回收区没有和任何空闲区相邻，将回收区作为单独的一个空闲盘区挂到链尾。

离散分配、连续分配都适用。为一个文件分配多个盘块时效率更高

# 位示图法
位示图:每个二进制位对应一个盘块。在本例中，“0”代表盘块空闲,“1”代表盘块已分配。位示图一般用连续的“字”来表示，如本例中-个字的字长是16位，字中的每一位对应一个盘块。因此可以用 (字号，位号) 对应一个盘块号。当然有的题目中也描述为 (行号，列号)

重要重要重要:要能自已推出盘块号与(字号位号)相互转换的公式。

注意题目条件:盘块号、字号、位号到底是从0开始还是从1开始

(字号,位号)=(i,j)的二进制位对应的 盘块号 b = ni +j

b号盘块对应的字号i= b/n，位号j= b%n

如何分配:若文件需要K个块
1. 顺序扫描位示图，找到K个相邻或不相邻的“0”;
2. 根据字号、位号算出对应的盘块号，将相应盘块分配给文件;
3. 将相应位设置为“1”

如何回收:
1. 根据回收的盘块号计算出对应的字号、位号:
2. 将相应二进制位设为"0"

连续分配和离散分配都适用
# 成组链接法
空闲表法、空闲链表法不适用于大型文件系统，因为空闲表或空闲链表可能过大。UNIX系统中采用了成组链接法对磁盘空闲块进行管理。

文件卷的目录区中专门用一个磁盘块作为“超级块”，当系统启动时需要将超级块读入内存。并且要保证内存与外存中的“超级块”数据一致。

